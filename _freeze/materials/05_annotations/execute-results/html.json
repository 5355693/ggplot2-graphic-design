{
  "hash": "247117b9b18f258eb34803d46d9eda7e",
  "result": {
    "markdown": "---\ntitle: \"Graphic Design with ggplot2\"\nsubtitle: \"<span style='font-size:1.75em;line-height:1.1;'>Working with Labels and Annotations</span></span>\"\nauthor: \"<b style='color:#28a87d;'>Cédric Scherer</b> **//** rstudio::conf **//** July 2022\"\nformat:\n  revealjs:\n    theme: css/style.scss\n    footer: '**[Cédric Scherer](https::/cedricscherer.com) //** rstudio::conf **//** July 2022'\n    #'rstudio::conf(workshop = \"Graphic Design with ggplot2\", instructor = \"Cédric Scherer\")'\n    transition: fade\n    progress: true\n    multiplex: false\n    preview-links: true\n    scrollable: false\n    hide-inactive-cursor: true\n    highlight-style: printing\n    chalkboard:\n      theme: whiteboard\n      boardmarker-width: 4\n      buttons: true\n    pause: true\n    mainfont: Cabinet Grotesk\neditor: source\nknitr:\n  opts_chunk:\n    dev: \"ragg_png\"\n    retina: 1\n    dpi: 300\nexecute:\n  freeze: auto\n  echo: true\n  fig-width: 5\n  fig-height: 6\n---\n\n\n## Setup\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n\nbikes <- readr::read_csv(\n  here::here(\"data\", \"london-bikes-custom.csv\"),\n  col_types = \"Dcfffilllddddc\"\n)\n\n#bikes$season <- factor(bikes$season, levels = c(\"spring\", \"summer\", \"autumn\", \"winter\"))\nbikes$season <- forcats::fct_inorder(bikes$season)\n\ntheme_set(theme_light(base_size = 14, base_family = \"Roboto Condensed\"))\n\ntheme_update(\n  panel.grid.minor = element_blank(),\n  legend.position = \"top\"\n)\n```\n:::\n\n\n# Labels + `theme()`\n\n## Working with Labels\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code  code-line-numbers=\"9,10,11,12,13,14,15,16,17\"}\ng <- ggplot(\n    bikes,\n    aes(x = temp_feel, y = count,\n        color = season)\n  ) +\n  geom_point(\n    alpha = .5\n  ) +\n  labs(\n    x = \"Feels-like temperature (°F)\",\n    y = \"Reported bike shares\",\n    title = \"TfL bike sharing trends\",\n    subtitle = \"Reported bike rents versus feels-like temperature in London\",\n    caption = \"Data: TfL\",\n    color = \"Season:\",\n    tag = \"1.\"\n  )\n\ng\n```\n\n::: {.cell-output-display}\n![](05_annotations_files/figure-revealjs/ggplot-labs-bundled-extended-1.png){width=1500}\n:::\n:::\n\n\n## Customize Labels via \\`theme()\\`\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code}\ng + theme(\n  plot.title = element_text(face = \"bold\"),\n  plot.title.position = \"plot\"\n)\n```\n\n::: {.cell-output-display}\n![](05_annotations_files/figure-revealjs/ggplot-theme-title-1.png){width=1500}\n:::\n:::\n\n\n## Customize Labels via \\`theme()\\`\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code  code-line-numbers=\"4,5,6\"}\ng + theme(\n  plot.title = element_text(face = \"bold\"),\n  plot.title.position = \"plot\",\n  axis.text = element_text(\n    color = \"grey40\"\n  )\n)\n```\n\n::: {.cell-output-display}\n![](05_annotations_files/figure-revealjs/ggplot-labs-theme-element-text-1.png){width=1500}\n:::\n:::\n\n\n## Customize Labels via \\`theme()\\`\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code  code-line-numbers=\"6|7|8|9|10|11|12\"}\ng + theme(\n  plot.title = element_text(face = \"bold\"),\n  plot.title.position = \"plot\",\n  axis.text = element_text(\n    color = \"grey40\",\n    family = \"Tabular\",\n    face = \"italic\",\n    hjust = 1,\n    vjust = 0,\n    angle = 45,\n    lineheight = 1.3, ## no effect here\n    margin = margin(10, 0, 20, 0)\n  )\n)\n```\n\n::: {.cell-output-display}\n![](05_annotations_files/figure-revealjs/ggplot-labs-theme-element-text-more-1.png){width=1500}\n:::\n:::\n\n\n## Customize Labels via \\`theme()\\`\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code  code-line-numbers=\"16,17,18\"}\ng + theme(\n  plot.title = element_text(face = \"bold\"),\n  plot.title.position = \"plot\",\n  axis.text = element_text(\n    color = \"grey40\",\n    family = \"Tabular\",\n    face = \"italic\",\n    colour = NULL,\n    size = NULL,\n    hjust = 1,\n    vjust = 0,\n    angle = 45,\n    lineheight = 1.3, ## no effect here\n    margin = margin(10, 0, 20, 0) ## no effect here\n  ),\n  axis.text.x = element_text(\n    margin = margin(10, 0, 20, 0) ## trbl\n  )\n)\n```\n\n::: {.cell-output-display}\n![](05_annotations_files/figure-revealjs/ggplot-labs-theme-element-text-x-1.png){width=1500}\n:::\n:::\n\n\n## Customize Labels via \\`theme()\\`\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code  code-line-numbers=\"16,17,18\"}\ng + theme(\n  plot.title = element_text(face = \"bold\"),\n  plot.title.position = \"plot\",\n  axis.text = element_text(\n    color = \"grey40\",\n    family = \"Tabular\",\n    face = \"italic\",\n    colour = NULL,\n    size = NULL,\n    hjust = 1,\n    vjust = 0,\n    angle = 45,\n    lineheight = 1.3, ## no effect here\n    margin = margin(10, 0, 20, 0) ## no effect here\n  ),\n  plot.tag = element_text(\n    margin = margin(0, 12, -8, 0) ## trbl\n  )\n)\n```\n\n::: {.cell-output-display}\n![](05_annotations_files/figure-revealjs/ggplot-labs-theme-element-text-tag-1.png){width=1500}\n:::\n:::\n\n\n## Customize Labels via \\`theme()\\`\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code  code-line-numbers=\"15,19\"}\ng + theme(\n  plot.title = element_text(face = \"bold\"),\n  plot.title.position = \"plot\",\n  axis.text = element_text(\n    color = \"grey40\",\n    family = \"Tabular\",\n    face = \"italic\",\n    colour = NULL,\n    size = NULL,\n    hjust = 1,\n    vjust = 0,\n    angle = 45,\n    lineheight = 1.3, ## no effect here\n    margin = margin(10, 0, 20, 0), ## no effect here\n    debug = TRUE\n  ),\n  plot.tag = element_text(\n    margin = margin(0, 12, -8, 0), ## trbl\n    debug = TRUE\n  )\n)\n```\n\n::: {.cell-output-display}\n![](05_annotations_files/figure-revealjs/ggplot-labs-theme-element-text-debug-1.png){width=1500}\n:::\n:::\n\n\n# Labels + `scale_*()`\n\n## Format Labels via \\`scale\\_\\*\\`\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code  code-line-numbers=\"1|3,4,5,6\"}\ng <- g + labs(title = NULL, subtitle = NULL, tag = NULL)\n\ng +\n  scale_y_continuous(\n    breaks = 0:4*15000\n  )\n```\n\n::: {.cell-output-display}\n![](05_annotations_files/figure-revealjs/scales-xy-continuous-labels-scales-prep-1.png){width=1500}\n:::\n:::\n\n\n## Format Labels via \\`scale\\_\\*\\`\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code  code-line-numbers=\"4\"}\ng +\n  scale_y_continuous(\n    breaks = 0:4*15000,\n    labels = scales::comma_format()\n  )\n```\n\n::: {.cell-output-display}\n![](05_annotations_files/figure-revealjs/scales-xy-continuous-labels-scales-1-1.png){width=1500}\n:::\n:::\n\n\n## Format Labels via \\`scale\\_\\*\\`\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code  code-line-numbers=\"5|7\"}\ng +\n  scale_y_continuous(\n    breaks = 0:4*15000,\n    labels = scales::comma_format(\n      suffix = \" bikes\"\n    ),\n    name = NULL\n  )\n```\n\n::: {.cell-output-display}\n![](05_annotations_files/figure-revealjs/scales-xy-continuous-labels-scales-2-1.png){width=1500}\n:::\n:::\n\n\n## Format Labels via \\`scale\\_\\*\\`\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code  code-line-numbers=\"5|9,10,11,12,13\"}\ng +\n  scale_y_continuous(\n    breaks = 0:4*15000,\n    labels = scales::comma_format(\n      suffix = \"\\nbikes shared\"\n    ),\n    name = NULL\n  ) +\n  theme(\n    axis.text.y = element_text(\n      hjust = .5\n    )\n  )\n```\n\n::: {.cell-output-display}\n![](05_annotations_files/figure-revealjs/scales-xy-continuous-labels-scales-3-1.png){width=1500}\n:::\n:::\n\n\n## Format Labels via \\`scale\\_\\*\\`\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code  code-line-numbers=\"5|5,7\"}\ng +\n  scale_y_continuous(\n    breaks = 0:4*15000,\n    labels = scales::comma_format(\n      scale = .001\n    ),\n    name = \"Reported bike shares in thousands\"\n  )\n```\n\n::: {.cell-output-display}\n![](05_annotations_files/figure-revealjs/scales-xy-continuous-labels-scales-4-1.png){width=1500}\n:::\n:::\n\n\n## Format Labels via \\`scale\\_\\*\\`\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code  code-line-numbers=\"4\"}\ng +\n  scale_y_continuous(\n    breaks = 0:4*15000,\n    labels = function(y) y / 1000,\n    name = \"Reported bike shares in thousands\",\n  )\n```\n\n::: {.cell-output-display}\n![](05_annotations_files/figure-revealjs/scales-xy-continuous-labels-function-1.png){width=1500}\n:::\n:::\n\n\n## Format Labels via \\`scale\\_\\*\\`\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code  code-line-numbers=\"2|3|4\"}\ng +\n  scale_x_continuous(\n    labels = function(y) paste0(y, \"°F\"),\n    name = \"Feels-Like Temperature\"\n  )\n```\n\n::: {.cell-output-display}\n![](05_annotations_files/figure-revealjs/scales-xy-continuous-labels-function-paste-1.png){width=1500}\n:::\n:::\n\n\n## Format Labels via \\`scale\\_\\*\\`\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code}\nggplot(\n    bikes,\n    aes(x = season, y = count)\n  ) +\n  geom_boxplot() +\n  scale_x_discrete()\n```\n\n::: {.cell-output-display}\n![](05_annotations_files/figure-revealjs/scales-xy-discrete-labels-1.png){width=1500}\n:::\n:::\n\n\n## Format Labels via \\`scale\\_\\*\\`\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code  code-line-numbers=\"8|7,8\"}\nggplot(\n    bikes,\n    aes(x = season, y = count)\n  ) +\n  geom_boxplot() +\n  scale_x_discrete(\n    name = NULL,\n    labels = stringr::str_to_title\n  )\n```\n\n::: {.cell-output-display}\n![](05_annotations_files/figure-revealjs/scales-xy-discrete-labels-function-1.png){width=1500}\n:::\n:::\n\n\n## Format Labels via \\`scale\\_\\*\\`\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code  code-line-numbers=\"2,4\"}\ng +\n  scale_color_discrete(\n    name = NULL,\n    labels = stringr::str_to_title\n  )\n```\n\n::: {.cell-output-display}\n![](05_annotations_files/figure-revealjs/scales-color-discrete-name-labels-1.png){width=1500}\n:::\n:::\n\n\n# Labels +<br>`element_markdown`\n\n## Styling Labels with {ggtext}\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code  code-line-numbers=\"2\"}\ng +\n  ggtitle(\"**TfL bike sharing trends by _season_**\")\n```\n\n::: {.cell-output-display}\n![](05_annotations_files/figure-revealjs/ggtext-prep-markdown-1.png){width=1500}\n:::\n:::\n\n\n## Styling Labels with {ggtext}\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code  code-line-numbers=\"4,5,6,7|4|6\"}\n# install.packages(\"ggtext\")\n\ng +\n  ggtitle(\"**TfL bike sharing trends by _season_**\") +\n  theme(\n    plot.title = ggtext::element_markdown()\n  )\n```\n\n::: {.cell-output-display}\n![](05_annotations_files/figure-revealjs/ggtext-element-markdown-1.png){width=1500}\n:::\n:::\n\n\n## Styling Labels with {ggtext}\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code  code-line-numbers=\"4|4,6\"}\n# install.packages(\"ggtext\")\n\ng +\n  ggtitle(\"<b style='font-family:tabular;font-size:25pt'>TfL</b> bike sharing trends by <i style='color:#28a87d;'>season</i>\") +\n  theme(\n    plot.title = ggtext::element_markdown()\n  )\n```\n\n::: {.cell-output-display}\n![](05_annotations_files/figure-revealjs/ggtext-element-markdown-html-1.png){width=1500}\n:::\n:::\n\n\n<p style=\"font-size:12pt;\">\n\n`<b style='font-family:tabular;font-size:25pt'>TfL</b> bike sharing trends by <i style='color:#28a87d;'>season</i>`\n\n</p>\n\n# Labels + `facet_*()`\n\n## Facet Labellers\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code  code-line-numbers=\"4\"}\ng +\n  facet_wrap(\n    ~ day_night,\n    labeller = label_both\n  )\n```\n\n::: {.cell-output-display}\n![](05_annotations_files/figure-revealjs/facet-wrap-labels-1-1.png){width=1500}\n:::\n:::\n\n\n## Facet Labellers\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code  code-line-numbers=\"3,4\"}\ng +\n  facet_wrap(\n    ~ is_workday + day_night,\n    labeller = label_both\n  )\n```\n\n::: {.cell-output-display}\n![](05_annotations_files/figure-revealjs/facet-wrap-labels-2-1.png){width=1500}\n:::\n:::\n\n\n## Facet Labellers\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code  code-line-numbers=\"4,6|4,5,6\"}\ng +\n  facet_wrap(\n    ~ is_workday + day_night,\n    labeller = labeller(\n      day_night = stringr::str_to_title\n    )\n  )\n```\n\n::: {.cell-output-display}\n![](05_annotations_files/figure-revealjs/facet-wrap-labels-3-1.png){width=1500}\n:::\n:::\n\n\n## Facet Labellers\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code  code-line-numbers=\"1,2,3,4|10,11\"}\ncodes <- c(\n  `TRUE` = \"Workday\",\n  `FALSE` = \"Weekend or Holiday\"\n)\n\ng +\n  facet_wrap(\n    ~ is_workday + day_night,\n    labeller = labeller(\n      day_night = stringr::str_to_title,\n      is_workday = codes\n    )\n  )\n```\n\n::: {.cell-output-display}\n![](05_annotations_files/figure-revealjs/facet-wrap-labels-4-1.png){width=1500}\n:::\n:::\n\n\n\n\n## Facet Labellers\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code  code-line-numbers=\"10\"}\ncodes <- c(\n  `TRUE` = \"Workday\",\n  `FALSE` = \"Weekend or Holiday\"\n)\n\ng +\n  facet_wrap(\n    ~ is_workday + day_night,\n    labeller = labeller(\n      .default = stringr::str_to_title,\n      is_workday = codes\n    )\n  )\n```\n\n::: {.cell-output-display}\n![](05_annotations_files/figure-revealjs/facet-wrap-labels-5-1.png){width=1500}\n:::\n:::\n\n\n\n\n## Facet Labeller\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code  code-line-numbers=\"6,7,8,9\"}\ng +\n  facet_grid(\n    day_night ~ is_workday,\n    scales = \"free\",\n    space = \"free\",\n    labeller = labeller(\n      day_night = stringr::str_to_title,\n      is_workday = codes\n    )\n  )\n```\n\n::: {.cell-output-display}\n![](05_annotations_files/figure-revealjs/facet-grid-labeller-1.png){width=1500}\n:::\n:::\n\n\n\n\n# Handling Long Labels\n\n\n\n## Handling Long Labels with {stringr}\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code}\nggplot(\n    bikes,\n    aes(x = weather_type,\n        y = count)\n  ) +\n  geom_boxplot()\n```\n\n::: {.cell-output-display}\n![](05_annotations_files/figure-revealjs/stringr-default-labs-1.png){width=1500}\n:::\n:::\n\n\n\n\n## Handling Long Labels with {stringr}\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code  code-line-numbers=\"3\"}\nggplot(\n    bikes,\n    aes(x = stringr::str_wrap(weather_type, 6),\n        y = count)\n  ) +\n  geom_boxplot()\n```\n\n::: {.cell-output-display}\n![](05_annotations_files/figure-revealjs/stringr-wrap-labs-1.png){width=1500}\n:::\n:::\n\n\n## Handling Long Labels with {ggtext}\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code  code-line-numbers=\"2|3,4,5,6|4\"}\ng +\n  ggtitle(\"TfL bike sharing trends in 2015 and 2016 by season for day and night periods\") +\n  theme(\n    plot.title = element_text(size = 20),\n    plot.title.position = \"plot\"\n  )\n```\n\n::: {.cell-output-display}\n![](05_annotations_files/figure-revealjs/ggtext-text-default-1.png){width=1500}\n:::\n:::\n\n\n## Handling Long Labels\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code  code-line-numbers=\"2|3,4,5,6|4\"}\ng +\n  ggtitle(\"TfL bike sharing trends in 2015 and 2016 by season for day and night periods\") +\n  theme(\n    plot.title =\n      ggtext::element_textbox_simple(size = 20),\n    plot.title.position = \"plot\"\n  )\n```\n\n::: {.cell-output-display}\n![](05_annotations_files/figure-revealjs/ggtext-textbox-default-1.png){width=1500}\n:::\n:::\n\n\n## Handling Long Labels\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code  code-line-numbers=\"5,6\"}\ng +\n  ggtitle(\"TfL bike sharing trends in 2015 and 2016 by season for day and night periods\") +\n  theme(\n    plot.title = ggtext::element_textbox_simple(\n      margin = margin(t = 12, b = 12),\n      lineheight = .9\n    ),\n    plot.title.position = \"plot\"\n  )\n```\n\n::: {.cell-output-display}\n![](05_annotations_files/figure-revealjs/ggtext-textbox-margin-1.png){width=1500}\n:::\n:::\n\n\n## Handling Long Labels\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code  code-line-numbers=\"6\"}\ng +\n  ggtitle(\"TfL bike sharing trends in 2015 and 2016 by season for day and night periods\") +\n  theme(\n    plot.title = ggtext::element_textbox_simple(\n      margin = margin(t = 12, b = 12),\n      fill = \"grey90\",\n      lineheight = .9\n    ),\n    plot.title.position = \"plot\"\n  )\n```\n\n::: {.cell-output-display}\n![](05_annotations_files/figure-revealjs/ggtext-textbox-box-1.png){width=1500}\n:::\n:::\n\n\n## Handling Long Labels\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code  code-line-numbers=\"6|8|9|10|11\"}\ng +\n  ggtitle(\"TfL bike sharing trends in 2015 and 2016 by season for day and night periods\") +\n  theme(\n    plot.title = ggtext::element_textbox_simple(\n      margin = margin(t = 12, b = 12),\n      padding = margin(rep(12, 4)),\n      fill = \"grey90\",\n      box.color = \"grey40\",\n      r = unit(9, \"pt\"),\n      halign = .5,\n      face = \"bold\",\n      lineheight = .9\n    ),\n    plot.title.position = \"plot\"\n  )\n```\n\n::: {.cell-output-display}\n![](05_annotations_files/figure-revealjs/ggtext-textbox-box-styled-1.png){width=1500}\n:::\n:::\n\n\n# Annotations with `annotate()`\n\n## Add Single Text Annotations\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code  code-line-numbers=\"3,4,5,6,7,8|4|5,6|7\"}\nggplot(bikes, aes(humidity, temp)) +\n  geom_point(size = 2, color = \"grey\") +\n  annotate(\n    geom = \"text\",\n    x = 90,\n    y = 27.5,\n    label = \"Some\\nadditional\\ntext\"\n  )\n```\n\n::: {.cell-output-display}\n![](05_annotations_files/figure-revealjs/annotate-text-1.png){width=1500}\n:::\n:::\n\n\n## Style Text Annotations\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code  code-line-numbers=\"8,9,10,11\"}\nggplot(bikes, aes(humidity, temp)) +\n  geom_point(size = 2, color = \"grey\") +\n  annotate(\n    geom = \"text\",\n    x = 90,\n    y = 27.5,\n    label = \"Some\\nadditional\\ntext\",\n    size = 6,\n    color = \"firebrick\",\n    fontface = \"bold\",\n    lineheight = .9\n  )\n```\n\n::: {.cell-output-display}\n![](05_annotations_files/figure-revealjs/annotate-text-adj-1.png){width=1500}\n:::\n:::\n\n\n## Add Multiple Text Annotations\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code  code-line-numbers=\"8,9,10,11\"}\nggplot(bikes, aes(humidity, temp)) +\n  geom_point(size = 2, color = \"grey\") +\n  annotate(\n    geom = \"text\",\n    x = c(90, 50),\n    y = c(27.5, 3.5),\n    label = c(\"Text A\", \"Text B\"),\n    color = c(\"black\", \"firebrick\"),\n    size = c(5, 10),\n    fontface = c(\"plain\", \"bold\")\n  )\n```\n\n::: {.cell-output-display}\n![](05_annotations_files/figure-revealjs/annotate-text-multiple-1.png){width=1500}\n:::\n:::\n\n\n## Add Boxes (Rectangles)\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code  code-line-numbers=\"4,5,6,7,8,9|4|5,6,7,8\"}\nggplot(bikes, aes(humidity, temp)) +\n  geom_point(size = 2, color = \"grey\") +\n  annotate(\n    geom = \"rect\",\n    xmin = -Inf,\n    xmax = 60,\n    ymin = 20,\n    ymax = Inf,\n    fill = \"#663399\"\n  )\n```\n\n::: {.cell-output-display}\n![](05_annotations_files/figure-revealjs/annotate-box-1.png){width=1500}\n:::\n:::\n\n\n## Add Boxes (Rectangles)\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code  code-line-numbers=\"1,2,9,10\"}\nggplot(bikes, aes(humidity, temp)) +\n  annotate(\n    geom = \"rect\",\n    xmin = -Inf,\n    xmax = 60,\n    ymin = 20,\n    ymax = Inf,\n    fill = \"#663399\"\n  ) +\n  geom_point(size = 2, color = \"grey\")\n```\n\n::: {.cell-output-display}\n![](05_annotations_files/figure-revealjs/annotate-box-hierarchy-1.png){width=1500}\n:::\n:::\n\n\n## Add Lines (Segments)\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code  code-line-numbers=\"11,12,13,14|12|13|14\"}\nggplot(bikes, aes(humidity, temp)) +\n  geom_point(size = 2, color = \"grey\") +\n  annotate(\n    geom = \"text\",\n    x = 90,\n    y = 27.5,\n    label = \"Some\\nadditional\\ntext\",\n    size = 6,\n    lineheight = .9\n  ) +\n  annotate(\n    geom = \"segment\",\n    x = 90, xend = 82,\n    y = 25, yend = 18.5\n  )\n```\n\n::: {.cell-output-display}\n![](05_annotations_files/figure-revealjs/annotate-text-line-1.png){width=1500}\n:::\n:::\n\n\n## Add Curves\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code  code-line-numbers=\"12\"}\nggplot(bikes, aes(humidity, temp)) +\n  geom_point(size = 2, color = \"grey\") +\n  annotate(\n    geom = \"text\",\n    x = 90,\n    y = 27.5,\n    label = \"Some\\nadditional\\ntext\",\n    size = 6,\n    lineheight = .9\n  ) +\n  annotate(\n    geom = \"curve\",\n    x = 90, xend = 82,\n    y = 25, yend = 18.5\n  )\n```\n\n::: {.cell-output-display}\n![](05_annotations_files/figure-revealjs/annotate-text-curve-1.png){width=1500}\n:::\n:::\n\n\n## Add Arrows\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code  code-line-numbers=\"13\"}\nggplot(bikes, aes(humidity, temp)) +\n  geom_point(size = 2, color = \"grey\") +\n  annotate(\n    geom = \"text\",\n    x = 90,\n    y = 27.5,\n    label = \"Some\\nadditional\\ntext\",\n    size = 6,\n    lineheight = .9\n  ) +\n  annotate(\n    geom = \"curve\",\n    x = 90, xend = 82,\n    y = 25, yend = 18.5,\n    curvature = -.3,\n    arrow = arrow()\n  )\n```\n\n::: {.cell-output-display}\n![](05_annotations_files/figure-revealjs/annotate-text-arrow-1.png){width=1500}\n:::\n:::\n\n\n## Add Arrows\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code  code-line-numbers=\"12,14,15,16,17|14,15,16\"}\nggplot(bikes, aes(humidity, temp)) +\n  geom_point(size = 2, color = \"grey\") +\n  annotate(\n    geom = \"text\",\n    x = 90,\n    y = 27.5,\n    label = \"Some\\nadditional\\ntext\",\n    size = 6,\n    lineheight = .9\n  ) +\n  annotate(\n    geom = \"curve\",\n    x = 90, xend = 82,\n    y = 25, yend = 18.5,\n    curvature = -.3,\n    arrow = arrow(\n      length = unit(10, \"pt\"),\n      type = \"closed\",\n      ends = \"both\"\n    )\n  )\n```\n\n::: {.cell-output-display}\n![](05_annotations_files/figure-revealjs/annotate-text-arrow-type2-1.png){width=1500}\n:::\n:::\n\n\n## Add Arrows\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code  code-line-numbers=\"15,16\"}\nggplot(bikes, aes(humidity, temp)) +\n  geom_point(size = 2, color = \"grey\") +\n  annotate(\n    geom = \"text\",\n    x = 90,\n    y = 27.5,\n    label = \"Some\\nadditional\\ntext\",\n    size = 6,\n    lineheight = .9\n  ) +\n  annotate(\n    geom = \"curve\",\n    x = 94, xend = 82,\n    y = 26, yend = 18.5,\n    curvature = -.8,\n    angle = 140,\n    arrow = arrow(\n      length = unit(10, \"pt\"),\n      type = \"closed\"\n    )\n  )\n```\n\n::: {.cell-output-display}\n![](05_annotations_files/figure-revealjs/annotate-text-arrow-skewed-1.png){width=1500}\n:::\n:::\n\n\n# Annotations with \\`geom\\_\\*()\\`'s'\n\n## Highlight Hot Periods\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code  code-line-numbers=\"1,2,3,4,5,6,7,8,9|2|2,9|5,6,7,8|6\"}\ng <- ggplot(\n    filter(bikes, temp >= 27),\n    aes(x = humidity, y = temp)\n  ) +\n  geom_point(\n    data = bikes,\n    color = \"grey65\", alpha = .3\n  ) +\n  geom_point(size = 2.5)\n```\n:::\n\n\n## Annotations with \\`geom_text()\\`\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code  code-line-numbers=\"10,11,12,13,14\"}\nggplot(\n    filter(bikes, temp >= 27),\n    aes(x = humidity, y = temp)\n  ) +\n  geom_point(\n    data = bikes,\n    color = \"grey65\", alpha = .3\n  ) +\n  geom_point(size = 2.5) +\n  geom_text(\n    aes(label = season),\n    nudge_x = .3,\n    hjust = 0\n  )\n```\n\n::: {.cell-output-display}\n![](05_annotations_files/figure-revealjs/highlight-geom-text-1.png){width=1500}\n:::\n:::\n\n\n## Annotations with \\`geom_label()\\`\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code  code-line-numbers=\"10\"}\nggplot(\n    filter(bikes, temp >= 27),\n    aes(x = humidity, y = temp)\n  ) +\n  geom_point(\n    data = bikes,\n    color = \"grey65\", alpha = .3\n  ) +\n  geom_point(size = 2.5) +\n  geom_label(\n    aes(label = season),\n    nudge_x = .3,\n    hjust = 0\n  )\n```\n\n::: {.cell-output-display}\n![](05_annotations_files/figure-revealjs/highlight-geom-label-1.png){width=1500}\n:::\n:::\n\n\n## Annotations with {ggrepel}\n\n\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code  code-line-numbers=\"10,11,12\"}\nggplot(\n    filter(bikes, temp >= 27),\n    aes(x = humidity, y = temp)\n  ) +\n  geom_point(\n    data = bikes,\n    color = \"grey65\", alpha = .3\n  ) +\n  geom_point(size = 2.5) +\n  ggrepel::geom_text_repel(\n    aes(label = season)\n  )\n```\n\n::: {.cell-output-display}\n![](05_annotations_files/figure-revealjs/highlight-geom-text-repel-1.png){width=1500}\n:::\n:::\n\n\n## Annotations with {ggrepel}\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code  code-line-numbers=\"4,14,15,16,17\"}\nggplot(\n    filter(bikes, temp >= 27),\n    aes(x = humidity, y = temp,\n        color = season == \"summer\")\n  ) +\n  geom_point(\n    data = bikes,\n    color = \"grey65\", alpha = .3\n  ) +\n  geom_point(size = 2.5) +\n  ggrepel::geom_text_repel(\n    aes(label = str_to_title(season))\n  ) +\n  scale_color_manual(\n    values = c(\"firebrick\", \"black\"),\n    guide = \"none\"\n  )\n```\n\n::: {.cell-output-display}\n![](05_annotations_files/figure-revealjs/highlight-geom-text-repel-color-1.png){width=1500}\n:::\n:::\n\n\n## Annotations with {ggrepel}\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code  code-line-numbers=\"13,14,15,16\"}\nggplot(\n    filter(bikes, temp >= 27),\n    aes(x = humidity, y = temp,\n        color = season == \"summer\")\n  ) +\n  geom_point(\n    data = bikes,\n    color = \"grey65\", alpha = .3\n  ) +\n  geom_point(size = 2.5) +\n  ggrepel::geom_text_repel(\n    aes(label = str_to_title(season)),\n    ## space between points + labels\n    box.padding = .4,\n    ## always draw segments\n    min.segment.length = 0\n  ) +\n  scale_color_manual(\n    values = c(\"firebrick\", \"black\"),\n    guide = \"none\"\n  )\n```\n\n::: {.cell-output-display}\n![](05_annotations_files/figure-revealjs/highlight-geom-text-repel-dist-1.png){width=1500}\n:::\n:::\n\n\n## Annotations with {ggrepel}\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code  code-line-numbers=\"13,14,20\"}\nggplot(\n    filter(bikes, temp >= 27),\n    aes(x = humidity, y = temp,\n        color = season == \"summer\")\n  ) +\n  geom_point(\n    data = bikes,\n    color = \"grey65\", alpha = .3\n  ) +\n  geom_point(size = 2.5) +\n  ggrepel::geom_text_repel(\n    aes(label = str_to_title(season)),\n    ## force to the right\n    xlim = c(NA, 35), hjust = 1\n  ) +\n  scale_color_manual(\n    values = c(\"firebrick\", \"black\"),\n    guide = \"none\"\n  ) +\n  xlim(25, NA)\n```\n\n::: {.cell-output-display}\n![](05_annotations_files/figure-revealjs/highlight-geom-text-repel-lim-1.png){width=1500}\n:::\n:::\n\n\n## Annotations with {ggrepel}\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code  code-line-numbers=\"15,16,17\"}\nggplot(\n    filter(bikes, temp >= 27),\n    aes(x = humidity, y = temp,\n        color = season == \"summer\")\n  ) +\n  geom_point(\n    data = bikes,\n    color = \"grey65\", alpha = .3\n  ) +\n  geom_point(size = 2.5) +\n  ggrepel::geom_text_repel(\n    aes(label = str_to_title(season)),\n    ## force to the right\n    xlim = c(NA, 35),\n    ## style segment\n    segment.curvature = .01,\n    arrow = arrow(length = unit(.02, \"npc\"), type = \"closed\")\n  ) +\n  scale_color_manual(\n    values = c(\"firebrick\", \"black\"),\n    guide = \"none\"\n  ) +\n  xlim(25, NA)\n```\n\n::: {.cell-output-display}\n![](05_annotations_files/figure-revealjs/highlight-geom-text-repel-arrow-1.png){width=1500}\n:::\n:::\n\n\n## Annotations with {ggrepel}\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code  code-line-numbers=\"15,16,17\"}\nggplot(\n    filter(bikes, temp >= 27),\n    aes(x = humidity, y = temp,\n        color = season == \"summer\")\n  ) +\n  geom_point(\n    data = bikes,\n    color = \"grey65\", alpha = .3\n  ) +\n  geom_point(size = 2.5) +\n  ggrepel::geom_text_repel(\n    aes(label = str_to_title(season)),\n    ## force to the right\n    xlim = c(NA, 35),\n    ## style segment\n    segment.curvature = .001,\n    segment.inflect = TRUE\n  ) +\n  scale_color_manual(\n    values = c(\"firebrick\", \"black\"),\n    guide = \"none\"\n  ) +\n  xlim(25, NA)\n```\n\n::: {.cell-output-display}\n![](05_annotations_files/figure-revealjs/highlight-geom-text-repel-inflect-1.png){width=1500}\n:::\n:::\n\n\n## Annotations with {ggforce}\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code  code-line-numbers=\"1,2,3,4,5,6,7,8,9,10,11,12,13,14|2|4,11,12,13,14\"}\nggplot(\n    filter(bikes, temp > 20 & season != \"summer\"),\n    aes(x = humidity, y = temp,\n        color = season)\n  ) +\n  geom_point(\n    data = bikes,\n    color = \"grey65\", alpha = .3\n  ) +\n  geom_point() +\n  scale_color_brewer(\n    palette = \"Dark2\",\n    guide = \"none\"\n  )\n```\n\n::: {.cell-output-display}\n![](05_annotations_files/figure-revealjs/highlight-geom-mark-prep-1.png){width=1500}\n:::\n:::\n\n\n## Annotations with {ggforce}\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code  code-line-numbers=\"11,12,13\"}\nggplot(\n    filter(bikes, temp > 20 & season != \"summer\"),\n    aes(x = humidity, y = temp,\n        color = season)\n  ) +\n  geom_point(\n    data = bikes,\n    color = \"grey65\", alpha = .3\n  ) +\n  geom_point() +\n  ggforce::geom_mark_rect(\n    aes(label = str_to_title(season))\n  ) +\n  scale_color_brewer(\n    palette = \"Dark2\",\n    guide = \"none\"\n  )\n```\n\n::: {.cell-output-display}\n![](05_annotations_files/figure-revealjs/highlight-geom-mark-rect-1.png){width=1500}\n:::\n:::\n\n\n## Annotations with {ggforce}\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code  code-line-numbers=\"18\"}\nggplot(\n    filter(bikes, temp > 20 & season != \"summer\"),\n    aes(x = humidity, y = temp,\n        color = season)\n  ) +\n  geom_point(\n    data = bikes,\n    color = \"grey65\", alpha = .3\n  ) +\n  geom_point() +\n  ggforce::geom_mark_rect(\n    aes(label = str_to_title(season))\n  ) +\n  scale_color_brewer(\n    palette = \"Dark2\",\n    guide = \"none\"\n  ) +\n  ylim(NA, 35)\n```\n\n::: {.cell-output-display}\n![](05_annotations_files/figure-revealjs/highlight-geom-mark-limit-1.png){width=1500}\n:::\n:::\n\n\n## Annotations with {ggforce}\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code  code-line-numbers=\"13,14,15,16,17,18|13,14|15,16,17|18\"}\nggplot(\n    filter(bikes, temp > 20 & season != \"summer\"),\n    aes(x = humidity, y = temp,\n        color = season)\n  ) +\n  geom_point(\n    data = bikes,\n    color = \"grey65\", alpha = .3\n  ) +\n  geom_point() +\n  ggforce::geom_mark_rect(\n    aes(label = str_to_title(season)),\n    expand = unit(5, \"pt\"),\n    radius = unit(0, \"pt\"),\n    con.cap = unit(0, \"pt\"),\n    label.buffer = unit(15, \"pt\"),\n    con.type = \"straight\",\n    label.fill = \"transparent\"\n  ) +\n  scale_color_brewer(\n    palette = \"Dark2\",\n    guide = \"none\"\n  ) +\n  ylim(NA, 35)\n```\n\n::: {.cell-output-display}\n![](05_annotations_files/figure-revealjs/highlight-geom-mark-customize-1.png){width=1500}\n:::\n:::\n\n\n## Annotations with {ggforce}\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code  code-line-numbers=\"1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16|1,2,3,4,5|4,13,14,15,16|7|8,9|10\"}\nggplot(\n    bikes,\n    aes(x = humidity, y = temp,\n        color = season == \"summer\")\n  ) +\n  geom_point(alpha = .4) +\n  ggforce::geom_mark_hull(\n    aes(label = str_to_title(season),\n        filter = season == \"summer\",\n        description = \"June to August\"),\n    expand = unit(10, \"pt\")\n  ) +\n  scale_color_manual(\n    values = c(\"grey65\", \"firebrick\"),\n    guide = \"none\"\n  )\n```\n\n::: {.cell-output-display}\n![](05_annotations_files/figure-revealjs/highlight-geom-mark-filter-1.png){width=1500}\n:::\n:::\n\n\n# Adding Images\n\n## Load and Modify Image\n\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"1,2,3,4,5|1|2|3\"}\nurl <- \"https://d33wubrfki0l68.cloudfront.net/dbb07b06a7b3fe056db386fef0b158cc2fd33cb9/8b491/assets/img/2022conf/logo-rstudio-conf.png\"\nimg <- magick::image_read(url)\nimg <- magick::image_negate(img)\n\nimg\n```\n\n::: {.cell-output-display}\n![](05_annotations_files/figure-revealjs/read-img-1.png){width=94}\n:::\n:::\n\n\n## Add Background Image\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code  code-line-numbers=\"3,4,5,6|3|4\"}\nggplot(bikes, aes(date, temp_feel)) +\n  annotation_custom(\n    grid::rasterGrob(\n      image = img\n    )\n  ) +\n  geom_point(color = \"#71a5d4\")\n```\n\n::: {.cell-output-display}\n![](05_annotations_files/figure-revealjs/annotate-custom-1.png){width=1500}\n:::\n:::\n\n\n## Adjust Position\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code  code-line-numbers=\"5,6,7,11\"}\nggplot(bikes, aes(date, temp_feel)) +\n  annotation_custom(\n    grid::rasterGrob(\n      image = img,\n      x = .5,\n      y = .9,\n      width = .9\n    )\n  ) +\n  geom_point(color = \"#71a5d4\") +\n  ylim(NA, 37)\n```\n\n::: {.cell-output-display}\n![](05_annotations_files/figure-revealjs/annotate-custom-position-1.png){width=1500}\n:::\n:::\n\n\n## Place Image Outside\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code  code-line-numbers=\"5,6,11,12,13,14|6,11,13\"}\nggplot(bikes, aes(date, temp_feel)) +\n  annotation_custom(\n    grid::rasterGrob(\n      image = img,\n      x = .47,\n      y = 1.15,\n      width = .9\n    )\n  ) +\n  geom_point(color = \"#71a5d4\") +\n  coord_cartesian(clip = \"off\") +\n  theme(\n    plot.margin = margin(90, 10, 10, 10)\n  )\n```\n\n::: {.cell-output-display}\n![](05_annotations_files/figure-revealjs/annotate-custom-position-outside-1.png){width=1500}\n:::\n:::\n\n\n## <b style='color:#663399;'>Recap</b>\n\n::: recap\n::: incremental\n-   style labels such as title, axis and legend texts with **`theme()`**\n-   format data-related labels with the **`labels`** argument of `scale_*()`\n-   adjust strip text with the **`facet_*(labeller)`** functionality\n-   add data-related annotations with **`geom_text|label()`**\n-   ... and data-unrelated annotations with **`annotate()`**\n-   **`annotation_custom(rasterGrob())`** is a basic way to add images\n-   **`{ggtext}`** allows to render labels with markdown and basic html\n-   `{ggtext}` also allows to add **dynamic linebreaks** and images\n-   **`{ggrepel}`** ensures clever placement of annotations\n-   **`ggforce::geom_mark_*()`** provide a set of advanced annotations\n:::\n:::\n\n# Exercises\n\n## Exercise 1\n\n::: question\n-   {ggtext} also comes with some new geom's. Explore those and other options on the package webpage: [wilkelab.rg/ggtext](https://wilkelab.org/ggtext/).\n-   **Create the following visualization, as close as possible**, with the `penguins` dataset which is provided by the [{palmerpenguins} package](https://allisonhorst.github.io/palmerpenguins/).\n    -   For the species labels, you likely have to create a summary data set.\n    -   Use the {ggtext} geometries and theme elements to format the labels.\n    -   Also, make use of the other components such as scales, original theme, and theme customization.\n:::\n\n------------------------------------------------------------------------\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](05_annotations_files/figure-revealjs/exercise-text-styling-1.png){fig-pos='center' width=1800}\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n```{=html}\n<div class=\"countdown\" id=\"timer_62de0867\" style=\"right:0;bottom:0;font-size:.5em;\" data-warnwhen=\"0\">\n<code class=\"countdown-time\"><span class=\"countdown-digits minutes\">20</span><span class=\"countdown-digits colon\">:</span><span class=\"countdown-digits seconds\">00</span></code>\n</div>\n```\n:::\n:::\n\n\n## Exercise 2\n\n::: question\n-   **Create this logo with the image file `exercises/rstudioconf-washington-bg.png`:**\n:::\n\n<br>\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](05_annotations_files/figure-revealjs/annotate-custom-rstudioconf-1.png){fig-align='center' width=1500}\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n```{=html}\n<div class=\"countdown\" id=\"timer_62de08dc\" style=\"right:0;bottom:0;font-size:.5em;\" data-warnwhen=\"0\">\n<code class=\"countdown-time\"><span class=\"countdown-digits minutes\">10</span><span class=\"countdown-digits colon\">:</span><span class=\"countdown-digits seconds\">00</span></code>\n</div>\n```\n:::\n:::\n",
    "supporting": [
      "05_annotations_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../site_libs/countdown-0.3.5/countdown.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/countdown-0.3.5/countdown.js\"></script>\n"
      ],
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    function fireSlideChanged(previousSlide, currentSlide) {\n\n      // dispatch for htmlwidgets\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for reveal\n    if (window.Reveal) {\n      window.Reveal.addEventListener(\"slidechanged\", function(event) {\n        fireSlideChanged(event.previousSlide, event.currentSlide);\n      });\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}