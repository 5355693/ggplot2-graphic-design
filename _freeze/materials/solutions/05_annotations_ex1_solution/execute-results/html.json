{
  "hash": "09f2ee584f8b6baf43f135e3d3daf632",
  "result": {
    "markdown": "---\ntitle: \"Graphic Design with ggplot2\"\nsubtitle: \"<span style='font-size:1.75em;line-height:1.1;'>Working with Labels and Annotations:<br><span style='font-weight:500;'>Solution Exercise 1</span></span>\"\nauthor: \"<b style='color:#28a87d;'>Cédric Scherer</b> **//** rstudio::conf **//** July 2022\"\nformat:\n  revealjs:\n    theme: css/style.scss\n    footer: '**[Cédric Scherer](https::/cedricscherer.com) //** rstudio::conf **//** July 2022'\n    #'rstudio::conf(workshop = \"Graphic Design with ggplot2\", instructor = \"Cédric Scherer\")'\n    transition: fade\n    progress: true\n    multiplex: false\n    preview-links: true\n    scrollable: false\n    hide-inactive-cursor: true\n    highlight-style: printing\n    chalkboard:\n      theme: whiteboard\n      boardmarker-width: 4\n      buttons: true\n    pause: true\n    mainfont: Cabinet Grotesk\neditor: source\nknitr:\n  opts_chunk:\n    dev: \"ragg_png\"\n    retina: 1\n    dpi: 300\nexecute:\n  freeze: auto\n  echo: true\n  fig-width: 5\n  fig-height: 6\n---\n\n\n\n## Exercise 1\n\n::: question\n- {ggtext} also comes with some new geom's. Explore those and other options on the package webpage: [wilkelab.rg/ggtext](https://wilkelab.org/ggtext/).\n- **Create the following visualization, as close as possible**, with the `penguins` dataset which is provided by the [{palmerpenguins} package](https://allisonhorst.github.io/palmerpenguins/).\n  - For the species labels, you likely have to create a summary data set.\n  - Use the {ggtext} geometries and theme elements to format the labels.\n  - Also, make use of the other components such as scales, original theme, and theme customization.\n:::\n\n\n------------------------------------------------------------------------\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](05_annotations_ex1_solution_files/figure-revealjs/exercise-text-styling-1.png){fig-align='center' width=1800}\n:::\n:::\n\n\n\n\n\n## The Data Set\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# install.packages(\"palmerpenguins\")\nlibrary(palmerpenguins)\n\npenguins\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 344 × 8\n   species island    bill_length_mm bill_depth_mm flipper_length_mm body_mass_g\n   <fct>   <fct>              <dbl>         <dbl>             <int>       <int>\n 1 Adelie  Torgersen           39.1          18.7               181        3750\n 2 Adelie  Torgersen           39.5          17.4               186        3800\n 3 Adelie  Torgersen           40.3          18                 195        3250\n 4 Adelie  Torgersen           NA            NA                  NA          NA\n 5 Adelie  Torgersen           36.7          19.3               193        3450\n 6 Adelie  Torgersen           39.3          20.6               190        3650\n 7 Adelie  Torgersen           38.9          17.8               181        3625\n 8 Adelie  Torgersen           39.2          19.6               195        4675\n 9 Adelie  Torgersen           34.1          18.1               193        3475\n10 Adelie  Torgersen           42            20.2               190        4250\n# … with 334 more rows, and 2 more variables: sex <fct>, year <int>\n```\n:::\n:::\n\n\n\n\n## Create a Labeled Bubble Chart\n\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"1,2,3,4,5,6|7,8,9,10,11,12\"}\nggplot(\n    penguins,\n    aes(x = bill_length_mm, y = bill_depth_mm,\n        color = species, size = body_mass_g)\n  ) +\n  geom_point(alpha = .2) +\n  labs(\n    x = \"Bill length (mm)\",\n    y = \"Bill depth (mm)\",\n    title = \"Bill dimensions of brush-tailed penguins Pygoscelis spec.\",\n    caption = \"Horst AM, Hill AP, Gorman KB (2020). palmerpenguins R package version 0.1.0\"\n  )\n```\n:::\n\n\n## A Labelled Bubble Plot\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](05_annotations_ex1_solution_files/figure-revealjs/annotations-exercise-1-1-1.png){width=1800}\n:::\n:::\n\n\n\n\n## Add a Custom Theme\n\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"13,14,15,16,17|13|14,15,16,17\"}\nggplot(\n    penguins,\n    aes(x = bill_length_mm, y = bill_depth_mm,\n        color = species, size = body_mass_g)\n  ) +\n  geom_point(alpha = .2) +\n  labs(\n    x = \"Bill length (mm)\",\n    y = \"Bill depth (mm)\",\n    title = \"Bill dimensions of brush-tailed penguins Pygoscelis spec.\",\n    caption = \"Horst AM, Hill AP, Gorman KB (2020). palmerpenguins R package version 0.1.0\"\n  ) +\n  theme_minimal(base_size = 10, base_family = \"Roboto Condensed\") +\n  theme(\n    plot.title.position = \"plot\",\n    plot.caption.position = \"plot\",\n    panel.grid.minor = element_blank()\n  )\n```\n:::\n\n\n## Add a Custom Theme\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](05_annotations_ex1_solution_files/figure-revealjs/annotations-exercise-1-2-1.png){width=1800}\n:::\n:::\n\n\n\n\n## Add an Outline\n\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"8\"}\np1 <-\n  ggplot(\n    penguins,\n    aes(x = bill_length_mm, y = bill_depth_mm,\n        color = species, size = body_mass_g)\n  ) +\n  geom_point(alpha = .2, stroke = .3) +\n  geom_point(shape = 1, stroke = .3) +\n  labs(\n    x = \"Bill length (mm)\",\n    y = \"Bill depth (mm)\",\n    title = \"Bill dimensions of brush-tailed penguins Pygoscelis spec.\",\n    caption = \"Horst AM, Hill AP, Gorman KB (2020). palmerpenguins R package version 0.1.0\"\n  ) +\n  theme_minimal(base_size = 10, base_family = \"Roboto Condensed\") +\n  theme(\n    plot.title.position = \"plot\",\n    plot.caption.position = \"plot\",\n    panel.grid.minor = element_blank()\n  )\n\np1\n```\n:::\n\n\n## Add an Outline\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](05_annotations_ex1_solution_files/figure-revealjs/annotations-exercise-1-3-1.png){width=1800}\n:::\n:::\n\n\n\n\n## Style Color Legend\n\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"2,3,4,5\"}\np1 +\n  scale_color_manual(\n    name = \"Species:\",\n    values = c(\"#FF8C00\", \"#A034F0\", \"#159090\")\n  )\n```\n:::\n\n\n## Style Color Legend\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](05_annotations_ex1_solution_files/figure-revealjs/annotations-exercise-1-4-1.png){width=1800}\n:::\n:::\n\n\n\n\n## Style Size Legend\n\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"13,14,15,16,17,18|13,17|16\"}\np2 <- p1 +\n  scale_color_manual(\n    name = \"Species:\",\n    values = c(\"#FF8C00\", \"#A034F0\", \"#159090\")\n  ) +\n  scale_size(\n    name = \"Body mass:\",\n    breaks = 3:6 * 1000,\n    labels = function(x) paste(x / 1000, \"kg\"),\n    range = c(.5, 5)\n  )\n\np2\n```\n:::\n\n\n## Style Size Legend\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](05_annotations_ex1_solution_files/figure-revealjs/annotations-exercise-1-5-1.png){width=1800}\n:::\n:::\n\n\n\n\n## Adjust Axes\n\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"2,3,4,5,6,7,8,9,10,11\"}\np2 +\n  scale_x_continuous(\n    limits = c(30, 60),\n    breaks = 6:12*5,\n    expand = c(0, 0)\n  ) +\n  scale_y_continuous(\n    limits = c(12.5, 22.5),\n    breaks = seq(12.5, 22.5, by = 2.5),\n    expand = c(0, 0)\n  )\n```\n:::\n\n\n## Adjust Axes\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](05_annotations_ex1_solution_files/figure-revealjs/annotations-exercise-1-6-1.png){width=1800}\n:::\n:::\n\n\n\n\n## Adjust Axes\n\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"2,3,4,5\"}\np3 <- p2 +\n  coord_cartesian(\n    expand = FALSE,\n    clip = \"off\"\n  ) +\n  scale_x_continuous(\n    limits = c(30, 60),\n    breaks = 6:12*5\n  ) +\n  scale_y_continuous(\n    limits = c(12.5, 22.5),\n    breaks = seq(12.5, 22.5, by = 2.5)\n  )\n\np3\n```\n:::\n\n\n## Adjust Axes\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](05_annotations_ex1_solution_files/figure-revealjs/annotations-exercise-1-7-1.png){width=1800}\n:::\n:::\n\n\n\n\n## Fixed Coordinate System?\n\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"2\"}\np2 +\n  coord_fixed(\n    expand = FALSE,\n    clip = \"off\"\n  ) +\n  scale_x_continuous(\n    limits = c(30, 60),\n    breaks = 6:12*5\n  ) +\n  scale_y_continuous(\n    limits = c(12.5, 22.5),\n    breaks = seq(12.5, 22.5, by = 2.5)\n  )\n```\n:::\n\n\n## Fixed Coordinate System?\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](05_annotations_ex1_solution_files/figure-revealjs/annotations-exercise-1-7-fixed-1.png){width=1800}\n:::\n:::\n\n\n\n\n## Format Labels with {ggtext}\n\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"3,4,5,6\"}\np3 +\n  labs(\n    x = \"Bill length *(mm)*\",\n    y = \"Bill depth *(mm)*\",\n    title = \"Bill dimensions of brush-tailed penguins *Pygoscelis spec.*\",\n    caption = \"Horst AM, Hill AP, Gorman KB (2020). <span style='font-family:tabular;'>palmerpenguins</span> R package version 0.1.0\"\n  )\n```\n:::\n\n\n## Format Labels with {ggtext}\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](05_annotations_ex1_solution_files/figure-revealjs/annotations-exercise-1-8-1.png){width=1800}\n:::\n:::\n\n\n\n\n## Format Labels with {ggtext}\n\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"1,11,13,14,16,17,18|12,15\"}\nlibrary(ggtext)\n\np4 <- p3 +\n  labs(\n    x = \"Bill length *(mm)*\",\n    y = \"Bill depth *(mm)*\",\n    title = \"Bill dimensions of brush-tailed penguins *Pygoscelis spec.*\",\n    caption = \"Horst AM, Hill AP, Gorman KB (2020). <span style='font-family:tabular;'>palmerpenguins</span> R package version 0.1.0\"\n  ) +\n  theme(\n    plot.title = element_markdown(\n      face = \"bold\", size = 16, margin = margin(12, 0, 12, 0)\n    ),\n    plot.caption = element_markdown(\n      size = 7, color = \"grey50\", margin = margin(12, 0, 6, 0)\n    ),\n    axis.title.x = element_markdown(margin = margin(t = 8)),\n    axis.title.y = element_markdown(margin = margin(r = 8))\n  )\n\np4\n```\n:::\n\n\n## Format Labels with {ggtext}\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](05_annotations_ex1_solution_files/figure-revealjs/annotations-exercise-1-9-1.png){width=1800}\n:::\n:::\n\n\n\n\n## Style Other Theme Elements\n\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"2,3,4,5,6,7|3|4|5,6\"}\np5 <- p4 +\n  theme(\n    axis.text = element_text(family = \"Tabular\"),\n    legend.text = element_text(color = \"grey50\"),\n    plot.margin = margin(0, 14, 0, 12),\n    plot.background = element_rect(fill = NA, color = \"grey50\", size = 1)\n  )\n\np5\n```\n:::\n\n\n\n## Style Other Theme Elements\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](05_annotations_ex1_solution_files/figure-revealjs/annotations-exercise-1-10-1.png){width=1800}\n:::\n:::\n\n\n\n\n\n## Create the Summary Data\n\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"1,2,3,4,5,6,7,8,9,10,11,12,13|3|4,5|5,6|7,8,9,10,11,12,13|8|9\"}\nlibrary(tidyverse)\n\npenguins_labs <-\n  penguins %>%\n  group_by(species) %>%\n  summarize(across(starts_with(\"bill\"), ~ mean(.x, na.rm = TRUE))) %>%\n  mutate(\n    species_lab = case_when(\n      species == \"Adelie\" ~ \"<b style='font-size:15pt;'>*P. adéliae*</b><br>(Adélie penguin)\",\n      species == \"Chinstrap\" ~ \"<b style='font-size:15pt;'>*P. antarctica*</b><br>(Chinstrap penguin)\",\n      species == \"Gentoo\" ~ \"<b style='font-size:15pt;'>*P. papua*</b><br>(Gentoo penguin)\"\n    )\n  )\n\npenguins_labs\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 3 × 4\n  species   bill_length_mm bill_depth_mm species_lab                            \n  <fct>              <dbl>         <dbl> <chr>                                  \n1 Adelie              38.8          18.3 <b style='font-size:15pt;'>*P. adéliae…\n2 Chinstrap           48.8          18.4 <b style='font-size:15pt;'>*P. antarct…\n3 Gentoo              47.5          15.0 <b style='font-size:15pt;'>*P. papua*<…\n```\n:::\n:::\n\n\n\n\n## Add Species Annotations\n\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"2,3,4,5,6|3|4,5\"}\np5 +\n  geom_richtext(\n    data = penguins_labs,\n    aes(label = species_lab),\n    color = \"black\", size = 3\n  )\n```\n:::\n\n\n## Add Species Annotations\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](05_annotations_ex1_solution_files/figure-revealjs/annotations-exercise-1-11-1.png){width=1800}\n:::\n:::\n\n\n\n\n## Style Species Annotations\n\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"6,7,8,9|6,7|8|9\"}\np5 +\n  geom_richtext(\n    data = penguins_labs,\n    aes(label = species_lab),\n    color = \"black\", size = 3,\n    family = \"Roboto Condensed\",\n    lineheight = .8,\n    fill = \"#ffffffab\", ## hex-alpha code\n    show.legend = FALSE\n  )\n```\n:::\n\n\n## Style Species Annotations\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](05_annotations_ex1_solution_files/figure-revealjs/annotations-exercise-1-12-1.png){width=1800}\n:::\n:::\n\n\n\n\n## Style Species Annotations\n\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"5,6|6\"}\np5 +\n  geom_richtext(\n    data = penguins_labs,\n    aes(label = species_lab,\n        color = species,\n        color = after_scale(colorspace::darken(color, .4))),\n    family = \"Roboto Condensed\",\n    size = 3, lineheight = .8,\n    fill = \"#ffffffab\",\n    show.legend = FALSE\n  )\n```\n:::\n\n\n## Style Species Annotations\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](05_annotations_ex1_solution_files/figure-revealjs/annotations-exercise-1-13-1.png){width=1800}\n:::\n:::\n\n\n\n\n## ... and Remove Color Legend\n\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"13\"}\np5 +\n  geom_richtext(\n    data = penguins_labs,\n    aes(label = species_lab,\n        color = species,\n        color = after_scale(colorspace::darken(color, .4))),\n    family = \"Roboto Condensed\",\n    size = 3, lineheight = .8,\n    fill = \"#ffffffab\", ## hex-alpha code\n    show.legend = FALSE\n  ) +\n  scale_color_manual(\n    guide = \"none\",\n    values = c(\"#FF8C00\", \"#A034F0\", \"#159090\")\n  )\n```\n:::\n\n\n\n\n## ... and Remove Color Legend\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](05_annotations_ex1_solution_files/figure-revealjs/annotations-exercise-1-14-1.png){width=1800}\n:::\n:::\n\n\n\n\n## Full Code\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(palmerpenguins)\nlibrary(ggtext)\n\npenguins_labs <-\n  penguins %>%\n  group_by(species) %>%\n  summarize(across(starts_with(\"bill\"), ~ mean(.x, na.rm = TRUE))) %>%\n  mutate(\n    species_lab = case_when(\n      species == \"Adelie\" ~ \"<b style='font-size:15pt;'>*P. adéliae*</b><br>(Adélie penguin)\",\n      species == \"Chinstrap\" ~ \"<b style='font-size:15pt;'>*P. antarctica*</b><br>(Chinstrap penguin)\",\n      species == \"Gentoo\" ~ \"<b style='font-size:15pt;'>*P. papua*</b><br>(Gentoo penguin)\"\n    )\n  )\n\nggplot(\n    penguins,\n    aes(x = bill_length_mm, y = bill_depth_mm,\n        color = species, size = body_mass_g)\n  ) +\n  geom_point(alpha = .2, stroke = .3) +\n  geom_point(shape = 1, stroke = .3) +\n  geom_richtext(\n    data = penguins_labs,\n    aes(label = species_lab,\n        color = species,\n        color = after_scale(colorspace::darken(color, .4))),\n    family = \"Roboto Condensed\",\n    size = 3, lineheight = .8,\n    fill = \"#ffffffab\", ## hex-alpha code\n    show.legend = FALSE\n  ) +\n  coord_cartesian(\n    expand = FALSE,\n    clip = \"off\"\n  )  +\n  scale_x_continuous(\n    limits = c(30, 60),\n    breaks = 6:12*5\n  ) +\n  scale_y_continuous(\n    limits = c(12.5, 22.5),\n    breaks = seq(12.5, 22.5, by = 2.5)\n  ) +\n  scale_color_manual(\n    guide = \"none\",\n    values = c(\"#FF8C00\", \"#A034F0\", \"#159090\")\n  ) +\n  scale_size(\n    name = \"Body mass:\",\n    breaks = 3:6 * 1000,\n    labels = function(x) paste(x / 1000, \"kg\"),\n    range = c(.25, 4.5)\n  ) +\n  labs(\n    x = \"Bill length *(mm)*\",\n    y = \"Bill depth *(mm)*\",\n    title = \"Bill dimensions of brush-tailed penguins *Pygoscelis spec.*\",\n    caption = \"Horst AM, Hill AP, Gorman KB (2020). <span style='font-family:tabular;'>palmerpenguins</span> R package version 0.1.0\"\n  ) +\n  theme_minimal(\n    base_size = 10, base_family = \"Roboto Condensed\"\n  ) +\n  theme(\n    plot.title = element_markdown(\n      face = \"bold\", size = 16, margin = margin(12, 0, 12, 0)\n    ),\n    plot.title.position = \"plot\",\n    plot.caption = element_markdown(\n      size = 7, color = \"grey50\",\n      margin = margin(12, 0, 6, 0)\n    ),\n    plot.caption.position = \"plot\",\n    axis.text = element_text(family = \"Tabular\"),\n    axis.title.x = element_markdown(margin = margin(t = 8)),\n    axis.title.y = element_markdown(margin = margin(r = 8)),\n    panel.grid.minor = element_blank(),\n    legend.text = element_text(color = \"grey50\"),\n    plot.margin = margin(0, 14, 0, 12),\n    plot.background = element_rect(fill = NA, color = \"grey50\", size = 1)\n  )\n```\n:::\n",
    "supporting": [
      "05_annotations_ex1_solution_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    function fireSlideChanged(previousSlide, currentSlide) {\n\n      // dispatch for htmlwidgets\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for reveal\n    if (window.Reveal) {\n      window.Reveal.addEventListener(\"slidechanged\", function(event) {\n        fireSlideChanged(event.previousSlide, event.currentSlide);\n      });\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}